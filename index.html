<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hunde Mega-Stammbaum & KI Analyse</title>
<style>
body {font-family: Arial,sans-serif;margin:0;padding:0;color:#222;background:#f0f0f0;}
header {text-align:center;padding:18px;font-size:28px;font-weight:bold;background:rgba(0,0,0,0.7);color:white;}
.container{display:flex;flex-wrap:wrap;justify-content:center;}
.tree{background:rgba(255,255,255,0.95);border-radius:12px;padding:18px;margin:15px;width:350px;box-shadow:0 4px 12px rgba(0,0,0,0.2);}
.node{padding:10px;margin:8px 0;background:#1e90ff;color:white;border-radius:8px;cursor:pointer;font-weight:bold;text-align:center;}
.child-nodes{margin-left:15px;display:none;}
.child-nodes .node{background:#3ea0ff;font-size:14px;}
.selected{background:#ff9933 !important;}
.ki-panel{background:rgba(255,255,255,0.95);padding:15px;margin:15px;border-radius:12px;max-width:600px;width:90%;box-shadow:0 4px 15px rgba(0,0,0,0.25);}
input,button{width:100%;padding:10px;margin:6px 0;border-radius:8px;border:1px solid #bbb;}
button{background:#1e90ff;color:white;border:none;font-weight:bold;cursor:pointer;}
button:hover{background:#3ea0ff;}
#previewImg,#previewVideo{width:100%;margin-top:10px;border-radius:8px;}
#antwort{margin-top:12px;background:#fafafa;padding:12px;border-radius:8px;min-height:80px;color:#111;white-space:pre-line;}
#contact{text-align:center;font-size:12px;margin-top:10px;color:#333;}
@media(max-width:768px){.tree,.ki-panel{width:95%;}}
</style>
</head>
<body>

<header>üêï Hunde Mega-Stammbaum & KI Analyse</header>

<div class="container">

<!-- Interaktiver Stammbaum -->
<div class="tree" id="tree">

<!-- Beispiel-Rassen mit Signalen -->
<div class="node" data-race="Labrador Retriever">
Labrador Retriever
<div class="child-nodes">
<div class="node" data-signal="Sitzend">Sitzend</div>
<div class="node" data-signal="Stehend">Stehend</div>
<div class="node" data-signal="Spielend">Spielend</div>
<div class="node" data-signal="Schwanz hoch">Schwanz hoch</div>
<div class="node" data-signal="Schwanz unten">Schwanz unten</div>
<div class="node" data-signal="Ohren vorne">Ohren vorne</div>
<div class="node" data-signal="Ohren angelegt">Ohren angelegt</div>
<div class="node" data-signal="R√∂cheln">R√∂cheln</div>
</div>
</div>

<div class="node" data-race="Mops">
Mops (Schwanz kurz/keiner)
<div class="child-nodes">
<div class="node" data-signal="Sitzend">Sitzend</div>
<div class="node" data-signal="Stehend">Stehend</div>
<div class="node" data-signal="Spielend">Spielend</div>
<div class="node" data-signal="Schwanz nicht vorhanden">Schwanz nicht vorhanden</div>
<div class="node" data-signal="Ohren vorne">Ohren vorne</div>
<div class="node" data-signal="Ohren angelegt">Ohren angelegt</div>
<div class="node" data-signal="R√∂cheln">R√∂cheln</div>
</div>
</div>

<div class="node" data-race="Deutscher Sch√§ferhund">
Deutscher Sch√§ferhund
<div class="child-nodes">
<div class="node" data-signal="Sitzend">Sitzend</div>
<div class="node" data-signal="Stehend">Stehend</div>
<div class="node" data-signal="Spielend">Spielend</div>
<div class="node" data-signal="Schwanz hoch">Schwanz hoch</div>
<div class="node" data-signal="Schwanz unten">Schwanz unten</div>
<div class="node" data-signal="Ohren vorne">Ohren vorne</div>
<div class="node" data-signal="Ohren angelegt">Ohren angelegt</div>
<div class="node" data-signal="R√∂cheln">R√∂cheln</div>
</div>
</div>

<!-- Button f√ºr neue Rasse -->
<button id="addRaceBtn">Neue Rasse hinzuf√ºgen</button>

</div>

<!-- KI Panel -->
<div class="ki-panel">
<input type="file" id="upload" accept="image/*,video/*">
<input type="text" id="search" placeholder="Frage √ºber deinen Hund">
<button id="analyzeBtn">Analysieren</button>

<img id="previewImg" style="display:none;">
<video id="previewVideo" controls style="display:none;"></video>

<div id="antwort"></div>
<div id="contact">Bei Fragen bitte an <a href="mailto:nebi6304@gmail.com">nebi6304@gmail.com</a> wenden.</div>
</div>

</div>

<script>
// Interaktiver Baum + Mehrfachauswahl
let selectedSignals = [];
let currentRace = null;

document.querySelectorAll('#tree .node').forEach(node => {
node.addEventListener('click', (e)=>{
e.stopPropagation();
const child = node.querySelector('.child-nodes');
if(child) child.style.display = child.style.display==='block'?'none':'block';

// Rasse ausw√§hlen
if(node.dataset.race){
currentRace = node.dataset.race;
selectedSignals = [];
document.querySelectorAll('#tree .node.selected').forEach(n=>n.classList.remove('selected'));
node.classList.add('selected');
document.getElementById('antwort').innerText = `Rasse: ${currentRace} ausgew√§hlt.`;
}

// Signale ausw√§hlen
if(node.dataset.signal){
if(selectedSignals.includes(node.dataset.signal)){
selectedSignals = selectedSignals.filter(s=>s!==node.dataset.signal);
node.classList.remove('selected');
} else {
selectedSignals.push(node.dataset.signal);
node.classList.add('selected');
}
document.getElementById('antwort').innerText = `Rasse: ${currentRace || '---'}\nSignale: ${selectedSignals.join(', ')}`;
}
});
});

// Neue Rasse hinzuf√ºgen
document.getElementById('addRaceBtn').addEventListener('click', ()=>{
const name = prompt("Name der neuen Rasse:");
if(!name) return;
const newNode = document.createElement('div');
newNode.className='node';
newNode.dataset.race = name;
newNode.innerText=name;
const childContainer = document.createElement('div');
childContainer.className='child-nodes';
newNode.appendChild(childContainer);
document.getElementById('tree').insertBefore(newNode, document.getElementById('addRaceBtn'));
});

// KI Analyse
document.getElementById('analyzeBtn').addEventListener('click', analyse);

async function analyse(){
const file = document.getElementById('upload').files[0];
const frage = document.getElementById('search').value;
const output = document.getElementById('antwort');

if(!currentRace && !frage && !file){
output.innerText="Bitte eine Rasse ausw√§hlen, Frage eingeben oder Datei hochladen.";
return;
}

output.innerText="KI analysiert... üîç";

let imageData = null;
if(file){
if(file.type.startsWith("video")){
document.getElementById("previewImg").style.display="none";
const vid = document.getElementById("previewVideo");
vid.style.display="block";
vid.src=URL.createObjectURL(file);
imageData = await videoScreenshot(file);
} else {
document.getElementById("previewVideo").style.display="none";
const img = document.getElementById("previewImg");
img.style.display="block";
img.src=URL.createObjectURL(file);
imageData = await fileToBase64(file);
}
}

try{
const res = await fetch("/api/ask",{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({
race: currentRace,
signals: selectedSignals,
question: frage,
image: imageData
})
});
const json = await res.json();
const antwortText = json?.choices?.[0]?.message?.content || "Keine Antwort gefunden.";
output.innerText = antwortText;
}catch(err){
output.innerText="Fehler bei der KI-Analyse.";
console.error(err);
}
}

async function fileToBase64(file){
return new Promise(resolve=>{
const reader = new FileReader();
reader.onload=()=>resolve(reader.result);
reader.readAsDataURL(file);
});
}

async function videoScreenshot(videoFile){
return new Promise(resolve=>{
const video=document.createElement("video");
video.src=URL.createObjectURL(videoFile);
video.currentTime=1;
video.muted=true;
video.addEventListener("loadeddata", ()=>{
const canvas=document.createElement("canvas");
canvas.width=video.videoWidth;
canvas.height=video.videoHeight;
const ctx=canvas.getContext("2d");
ctx.drawImage(video,0,0);
resolve(canvas.toDataURL("image/jpeg"));
});
});
}
</script>
</body>
</html>
