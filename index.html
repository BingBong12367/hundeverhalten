<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hunde Stammbaum & KI Analyse Mega-Version</title>
<style>
body {
font-family: Arial, sans-serif;
background-image: url('https://images.unsplash.com/photo-1518717758536-85ae29035b6d?auto=format&fit=crop&w=1400&q=80');
background-size: cover;
background-position: center;
color: #222;
margin: 0;
padding: 0;
}
header {
text-align: center;
padding: 18px;
font-size: 28px;
font-weight: bold;
background: rgba(0,0,0,0.7);
color: white;
}
.container {
display: flex;
flex-wrap: wrap;
justify-content: center;
}
.tree {
background: rgba(255,255,255,0.9);
border-radius: 12px;
padding: 18px;
margin: 15px;
width: 350px;
box-shadow: 0px 4px 12px rgba(0,0,0,0.2);
}
.node {
padding: 10px;
margin: 8px 0;
background: #1e90ff;
color: white;
border-radius: 8px;
cursor: pointer;
font-weight: bold;
text-align: center;
}
.child-nodes {
margin-left: 15px;
display: none;
}
.child-nodes .node {
background: #3ea0ff;
font-size: 14px;
}
.selected {
background: #ff9933 !important;
}
.ki-panel {
background: rgba(255,255,255,0.95);
padding: 15px;
margin: 15px;
border-radius: 12px;
max-width: 600px;
width: 90%;
box-shadow: 0px 4px 15px rgba(0,0,0,0.25);
}
input, button {
width: 100%;
padding: 10px;
margin: 6px 0;
border-radius: 8px;
border: 1px solid #bbb;
}
button {
background: #1e90ff;
color: white;
border: none;
font-weight: bold;
cursor: pointer;
}
button:hover { background: #3ea0ff }
#previewImg, #previewVideo {
width: 100%;
margin-top: 10px;
border-radius: 8px;
}
#antwort {
margin-top: 12px;
background: #fafafa;
padding: 12px;
border-radius: 8px;
min-height: 80px;
color: #111;
}
#contact {
text-align: center;
font-size: 12px;
margin-top: 10px;
color: #333;
}
@media (max-width: 768px) {
.tree, .ki-panel {
width: 95%;
}
}
</style>
</head>
<body>

<header>üêï Hunde Stammbaum & KI Analyse Mega-Version</header>

<div class="container">

<!-- Interaktiver Stammbaum -->
<div class="tree" id="tree">

<!-- Hunderassen Beispiele -->
<div class="node" data-info="Labrador Retriever sind freundlich, aktiv, familienbezogen.">
Labrador Retriever
<div class="child-nodes">
<div class="node" data-info="Sitzend: Beobachtet ruhig.">Sitzend</div>
<div class="node" data-info="Stehend: Aufmerksam.">Stehend</div>
<div class="node" data-info="Spielend: Spa√ü am Apportieren.">Spielend</div>
<div class="node" data-info="Schwanz hoch: Freude.">Schwanz hoch</div>
<div class="node" data-info="Schwanz unten: Ruhe/Unsicherheit.">Schwanz unten</div>
</div>
</div>

<div class="node" data-info="Mops: freundlich, verspielt, Schwanzkurz oder ohne Schwanz.">
Mops
<div class="child-nodes">
<div class="node" data-info="Sitzend: Beobachtet.">Sitzend</div>
<div class="node" data-info="Stehend: Aufmerksam.">Stehend</div>
<div class="node" data-info="Spielend: Aktiv.">Spielend</div>
<div class="node" data-info="Keine Schwanzkommunikation m√∂glich: wird schwerer zu interpretieren.">Schwanz nicht vorhanden</div>
</div>
</div>

<div class="node" data-info="Franz√∂sische Bulldogge: freundlich, verspielt, oft keine Schwanzkommunikation.">
Franz√∂sische Bulldogge
<div class="child-nodes">
<div class="node" data-info="Liegt: Entspannt.">Liegt</div>
<div class="node" data-info="Spielend: Aktiv.">Spielend</div>
<div class="node" data-info="Knurrend: Warnsignal.">Knurrend</div>
<div class="node" data-info="Schwanz hoch/nicht vorhanden: Bei manchen nicht interpretierbar.">Schwanz nicht vorhanden</div>
</div>
</div>

<!-- Weitere Rassen hier hinzuf√ºgen‚Ä¶ -->

<!-- Button um neue Rasse hinzuzuf√ºgen -->
<button id="addRaceBtn">Neue Rasse hinzuf√ºgen</button>

</div>

<!-- KI Panel -->
<div class="ki-panel">
<input type="file" id="upload" accept="image/*,video/*">
<input type="text" id="search" placeholder="Stelle eine Frage √ºber deinen Hund">
<button id="analyzeBtn">Analysieren</button>

<img id="previewImg" style="display:none;">
<video id="previewVideo" controls style="display:none;"></video>

<div id="antwort"></div>
<div id="contact">Bei Fragen bitte an <a href="mailto:nebi6304@gmail.com">nebi6304@gmail.com</a> wenden.</div>
</div>

</div>

<script>
// Interaktiver Baum + Mehrfachauswahl
const selectedNodes = new Set();

document.querySelectorAll('#tree .node').forEach(node => {
node.addEventListener('click', (e) => {
e.stopPropagation();
const child = node.querySelector('.child-nodes');
if (child) child.style.display = child.style.display === 'block' ? 'none' : 'block';

if(selectedNodes.has(node)) {
selectedNodes.delete(node);
node.classList.remove('selected');
} else {
selectedNodes.add(node);
node.classList.add('selected');
}

let infoText = Array.from(selectedNodes).map(n => n.dataset.info).filter(Boolean).join('\n');
document.getElementById('antwort').innerText = infoText;
});
});

// Neue Rasse hinzuf√ºgen
document.getElementById('addRaceBtn').addEventListener('click', () => {
const name = prompt("Name der neuen Rasse:");
if(!name) return;
const newNode = document.createElement('div');
newNode.className = 'node';
newNode.dataset.info = `${name}: Keine Informationen verf√ºgbar.`;
newNode.innerText = name;

const childContainer = document.createElement('div');
childContainer.className = 'child-nodes';
newNode.appendChild(childContainer);

document.getElementById('tree').insertBefore(newNode, document.getElementById('addRaceBtn'));
});

// KI Analyse
document.getElementById("analyzeBtn").addEventListener("click", analyse);

async function analyse() {
const file = document.getElementById("upload").files[0];
const frage = document.getElementById("search").value;
const output = document.getElementById("antwort");

if (!frage && !file) {
output.innerText = "Bitte Frage eingeben oder eine Datei hochladen.";
return;
}

output.innerText = "KI analysiert... üîç";

let imageData = null;
if(file){
if(file.type.startsWith("video")){
document.getElementById("previewImg").style.display="none";
const vid = document.getElementById("previewVideo");
vid.style.display="block";
vid.src = URL.createObjectURL(file);
imageData = await videoScreenshot(file);
} else {
document.getElementById("previewVideo").style.display="none";
const img = document.getElementById("previewImg");
img.style.display="block";
img.src = URL.createObjectURL(file);
imageData = await fileToBase64(file);
}
}

try {
const res = await fetch("/api/ask",{
method:"POST",
headers:{"Content-Type":"application/json"},
body: JSON.stringify({question:frage,image:imageData})
});
const json = await res.json();
const antwortText = json?.choices?.[0]?.message?.content || "Keine Antwort gefunden.";
output.innerText = antwortText;
} catch(err){
output.innerText = "Fehler bei der KI-Analyse.";
console.error(err);
}
}

// Hilfsfunktionen
async function fileToBase64(file){
return new Promise(resolve=>{
const reader = new FileReader();
reader.onload = ()=>resolve(reader.result);
reader.readAsDataURL(file);
});
}

async function videoScreenshot(videoFile){
return new Promise(resolve=>{
const video = document.createElement("video");
video.src = URL.createObjectURL(videoFile);
video.currentTime=1;
video.muted=true;
video.addEventListener("loadeddata", ()=>{
const canvas = document.createElement("canvas");
canvas.width = video.videoWidth;
canvas.height = video.videoHeight;
const ctx = canvas.getContext("2d");
ctx.drawImage(video,0,0);
resolve(canvas.toDataURL("image/jpeg"));
});
});
}
</script>

</body>
</html>
